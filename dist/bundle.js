(()=>{"use strict";var t={};function e(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=null,this.ctx=null,this.dimensions=null,this.doorMin=null,this.doorMax=null,this.dimensions=.8*window.innerHeight,$(".background-image").width(this.dimensions/2),$(".background-image").height(this.dimensions/2)}var o,n;return o=t,(n=[{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}])&&e(o.prototype,n),t}();function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var s=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(f,e);var o,n,s,u,l=(s=f,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=a(s);if(u){var o=a(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return c(this,t)});function f(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),(t=l.call(this)).canvasRect=null,t.canvas=document.getElementById("canvas-background"),t.ctx=t.canvas.getContext("2d"),t.canvas.width=t.dimensions,t.canvas.height=t.dimensions,t.doorMin=t.dimensions*(5/12),t.doorMax=t.dimensions*(7/12),t.canvasRect=t.canvas.getBoundingClientRect(),t}return o=f,(n=[{key:"draw",value:function(){this.clear();var e=t.g.player.room;this.ctx.lineWidth=20,this.drawWalls(),this.drawDoors(e),this.drawMarkers()}},{key:"drawWalls",value:function(){this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.moveTo(0,0),this.ctx.lineTo(this.doorMin,0),this.ctx.moveTo(this.doorMax,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.doorMin),this.ctx.moveTo(this.canvas.width,this.doorMax),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(this.doorMax,this.canvas.height),this.ctx.moveTo(this.doorMin,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,this.doorMax),this.ctx.moveTo(0,this.doorMin),this.ctx.lineTo(0,0),this.ctx.stroke()}},{key:"drawDoors",value:function(t){var e=new Door("up"),o=new Door("right"),n=new Door("down"),r=new Door("left");Room.rooms[t].up&&(e.status="active"),Room.rooms[t].right&&(o.status="active"),Room.rooms[t].down&&(n.status="active"),Room.rooms[t].left&&(r.status="active"),e.draw(),o.draw(),n.draw(),r.draw()}},{key:"drawMarkers",value:function(){var e=this;Object.keys(Room.rooms[t.g.player.room].markers).forEach((function(o){var n=Room.rooms[t.g.player.room].markers[o];e.ctx.beginPath(),e.ctx.arc(n.x,n.y,n.radius,0,2*Math.PI),e.ctx.fillStyle="blue",e.ctx.fill()}))}}])&&r(o.prototype,n),f}(o);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){return!e||"object"!==u(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(a,e);var o,n,r,i,c=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=y(r);if(i){var o=y(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return h(this,t)});function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=c.call(this)).canvas=document.getElementById("canvas-foreground"),t.ctx=t.canvas.getContext("2d"),t.canvas.width=t.dimensions,t.canvas.height=t.dimensions,t}return o=a,(n=[{key:"update",value:function(){!0!==t.g.player.finished&&(this.clear(),t.g.player.move(),this.draw(),requestAnimationFrame(this.update.bind(this)))}},{key:"draw",value:function(){this.ctx.beginPath(),this.ctx.arc(t.g.player.x,t.g.player.y,t.g.player.radius,0,2*Math.PI),this.ctx.fillStyle="purple",this.ctx.fill();var e=this;Object.keys(Room.rooms[t.g.player.room].treasure).forEach((function(o){var n=Room.rooms[t.g.player.room].treasure[o];n.update(),e.ctx.beginPath(),e.ctx.arc(n.x,n.y,n.radius,0,2*Math.PI),e.ctx.fillStyle="gold",e.ctx.fill()})),Object.keys(Room.rooms[t.g.player.room].enemies).forEach((function(o){var n=Room.rooms[t.g.player.room].enemies[o];n.update(),e.ctx.beginPath(),e.ctx.arc(n.x,n.y,n.radius,0,2*Math.PI),e.ctx.fillStyle="red",e.ctx.fill()})),Object.keys(t.g.player.projectiles).forEach((function(o){var n=t.g.player.projectiles[o];n.move(),e.ctx.beginPath(),e.ctx.arc(n.x,n.y,n.radius,0,2*Math.PI),e.ctx.fillStyle="blue",e.ctx.fill()}))}}])&&l(o.prototype,n),a}(o);function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e){return!e||"object"!==x(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function O(t){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(a,e);var o,n,r,i,c=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=O(r);if(i){var o=O(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return j(this,t)});function a(){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=c.call(this)).room=null,e.score=0,e.time=0,e.won=!1,e.projectileCounter=0,e.projectiles={},e.x=t.g.background.canvas.width/2,e.y=t.g.background.canvas.height/2,e.radius=t.g.background.canvas.height/40,e.speed=5,e.startTimer(),e}return o=a,(n=[{key:"startTimer",value:function(){var e=Date.now();setInterval((function(){if(!0!==t.g.player.finished){var o=Date.now()-e;t.g.player.time=Math.floor(o/1e3),$("#time").text("Time:  "+t.g.player.time)}}),100)}},{key:"hitDoor",value:function(){var e={};return null!==Room.rooms[t.g.player.room].up&&this.y-this.radius+this.dy-t.g.background.ctx.lineWidth<0&&this.variableBetweenValues(this.x,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="up",e.x=this.x,e.y=t.g.background.canvas.height-this.radius-t.g.background.ctx.lineWidth):null!==Room.rooms[t.g.player.room].right&&this.x+this.radius+this.dx+t.g.background.ctx.lineWidth>t.g.background.canvas.width&&this.variableBetweenValues(this.y,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="right",e.x=this.radius+t.g.background.ctx.lineWidth,e.y=this.y):null!==Room.rooms[t.g.player.room].down&&this.y+this.radius+this.dy+t.g.background.ctx.lineWidth>t.g.background.canvas.height&&this.variableBetweenValues(this.x,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="down",e.x=this.x,e.y=this.radius+t.g.background.ctx.lineWidth):null!==Room.rooms[t.g.player.room].left&&this.x-this.radius+this.dx-t.g.background.ctx.lineWidth<0&&this.variableBetweenValues(this.y,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="left",e.x=t.g.background.canvas.width-this.radius-t.g.background.ctx.lineWidth,e.y=this.y):e=!1,!1!==e&&"end"===Room.rooms[t.g.player.room][e.direction]&&(this.playerWon(),e=!1),e}},{key:"playerWon",value:function(){this.finished=!0,$("#result").text("You Win!!!")}},{key:"fireProjectile",value:function(t,e){this.projectiles[this.projectileCounter]=new Projectile(this.projectileCounter,t,e),this.projectileCounter++}},{key:"updateScore",value:function(t){this.score+=t,$("#score").text("Score:  "+this.score)}},{key:"resetPosition",value:function(){this.x=t.g.background.canvas.width/2,this.y=t.g.background.canvas.height/2}}])&&w(o.prototype,n),a}(function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(a,(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=null,this.x=0,this.y=0,this.radius=0,this.overlay=!1}));var o,n,r,i,c=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=v(r);if(i){var o=v(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return m(this,t)});function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=c.call(this)).speed=0,t.dx=0,t.dy=0,t.wallHit=!1,t}return o=a,(n=[{key:"move",value:function(){if(this.wallHit=this.getWallHit(),!1===this.wallHit)this instanceof Enemy?(this.x+=this.speed*this.dx,this.y+=this.speed*this.dy):(this.x+=this.dx,this.y+=this.dy);else if(this instanceof Projectile)delete t.g.player.projectiles[this.id];else if(this instanceof Player){var e=this.hitDoor();!1!==e&&(t.g.player.room=Room.rooms[t.g.player.room].changeRoom(e.direction),t.g.background.draw(),this.x=e.x,this.y=e.y)}else this instanceof Enemy&&("up"===this.wallHit||"down"===this.wallHit?this.dy*=-1:"right"!==this.wallHit&&"left"!==this.wallHit||(this.dx*=-1),this.x+=this.speed*this.dx,this.y+=this.speed*this.dy)}},{key:"getWallHit",value:function(){return this.x+this.radius+this.dx>t.g.background.canvas.width-t.g.background.ctx.lineWidth?"right":this.x-this.radius+this.dx<0+t.g.background.ctx.lineWidth?"left":this.y+this.radius+this.dy>t.g.background.canvas.height-t.g.background.ctx.lineWidth?"down":this.y-this.radius+this.dy<0+t.g.background.ctx.lineWidth&&"up"}},{key:"variableBetweenValues",value:function(t,e,o){return t>=e&&t<=o}}])&&g(o.prototype,n),a}());t.g.background=new s,t.g.player=new R,t.g.foreground=new d,fetch("./configuration.txt").then((function(t){return t.text()})).then((function(e){(function(t){var e=JSON.parse(t);return e.minimumNodes<Math.pow(e.gridSize,2)*e.removed&&!0})(e)?(console.log("here"),setupGame(),t.g.background.draw(),t.g.foreground.update()):console.log("invalid configuration")}))})();