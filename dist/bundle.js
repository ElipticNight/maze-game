(()=>{"use strict";var t={};function e(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=null,this.ctx=null,this.dimensions=null,this.doorMin=null,this.doorMax=null,this.dimensions=.8*window.innerHeight,$(".background-image").width(this.dimensions/2),$(".background-image").height(this.dimensions/2)}var o,r;return o=t,(r=[{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}])&&e(o.prototype,r),t}();function r(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var n=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.colours={},this.status=null,this.direction=null,this.colours.active="green",this.colours.disabled="black",this.colours.locked="red",this.status="disabled",this.direction=t}var o,n;return o=e,(n=[{key:"draw",value:function(){switch(this.direction){case"up":this.upDoor();break;case"right":this.rightDoor();break;case"down":this.downDoor();break;case"left":this.leftDoor()}}},{key:"upDoor",value:function(){t.g.background.ctx.beginPath(),t.g.background.ctx.strokeStyle=this.colours[this.status],t.g.background.ctx.moveTo(t.g.background.doorMin,0),t.g.background.ctx.lineTo(t.g.background.doorMax,0),t.g.background.ctx.stroke()}},{key:"rightDoor",value:function(){t.g.background.ctx.beginPath(),t.g.background.ctx.strokeStyle=this.colours[this.status],t.g.background.ctx.moveTo(t.g.background.canvas.width,t.g.background.doorMin),t.g.background.ctx.lineTo(t.g.background.canvas.width,t.g.background.doorMax),t.g.background.ctx.stroke()}},{key:"downDoor",value:function(){t.g.background.ctx.beginPath(),t.g.background.ctx.strokeStyle=this.colours[this.status],t.g.background.ctx.moveTo(t.g.background.doorMax,t.g.background.canvas.height),t.g.background.ctx.lineTo(t.g.background.doorMin,t.g.background.canvas.height),t.g.background.ctx.stroke()}},{key:"leftDoor",value:function(){t.g.background.ctx.beginPath(),t.g.background.ctx.strokeStyle=this.colours[this.status],t.g.background.ctx.moveTo(0,t.g.background.doorMax),t.g.background.ctx.lineTo(0,t.g.background.doorMin),t.g.background.ctx.stroke()}}])&&r(o.prototype,n),e}(),i=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=null,this.x=0,this.y=0,this.radius=0,this.overlay=!1};function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var f=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(f,e);var o,r,n,i,a=(n=f,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=l(n);if(i){var o=l(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return s(this,t)});function f(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),(t=a.call(this)).speed=0,t.dx=0,t.dy=0,t.wallHit=!1,t.type=null,t}return o=f,(r=[{key:"move",value:function(){if(this.wallHit=this.getWallHit(),!1===this.wallHit)"Enemy"==this.type?(this.x+=this.speed*this.dx,this.y+=this.speed*this.dy):(this.x+=this.dx,this.y+=this.dy);else if(this instanceof Projectile)delete t.g.player.projectiles[this.id];else if("Player"==this.type){var e=this.hitDoor();!1!==e&&(t.g.player.room=H.rooms[t.g.player.room].changeRoom(e.direction),t.g.background.draw(),this.x=e.x,this.y=e.y)}else"Enemy"==this.type&&("up"===this.wallHit||"down"===this.wallHit?this.dy*=-1:"right"!==this.wallHit&&"left"!==this.wallHit||(this.dx*=-1),this.x+=this.speed*this.dx,this.y+=this.speed*this.dy)}},{key:"getWallHit",value:function(){return this.x+this.radius+this.dx>t.g.background.canvas.width-t.g.background.ctx.lineWidth?"right":this.x-this.radius+this.dx<0+t.g.background.ctx.lineWidth?"left":this.y+this.radius+this.dy>t.g.background.canvas.height-t.g.background.ctx.lineWidth?"down":this.y-this.radius+this.dy<0+t.g.background.ctx.lineWidth&&"up"}},{key:"variableBetweenValues",value:function(t,e,o){return t>=e&&t<=o}}])&&c(o.prototype,r),f}(i);function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(c,e);var o,r,n,i,a=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=g(n);if(i){var o=g(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return p(this,t)});function c(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(t=a.call(this)).used=!1,t.setRandomPosition(),t}return o=c,(r=[{key:"setRandomPosition",value:function(){var e=t.g.background.canvas.width,o=t.g.background.canvas.height;this.x=Math.floor(Math.random()*(.6*e))+.2*e,this.y=Math.floor(Math.random()*(.6*o))+.2*e}},{key:"update",value:function(){this.detectHit()}},{key:"hit",value:function(t){return Math.pow(this.radius-t.radius,2)<=Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)&&Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)<=Math.pow(this.radius+t.radius,2)}}])&&y(o.prototype,r),c}(f);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function v(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function k(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}(c,e);var o,r,n,i,a=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=x(n);if(i){var o=x(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return k(this,t)});function c(e){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(o=a.call(this)).value=0,o.id=e,o.value=100*Math.floor(9*Math.random())+100,o.radius=t.g.background.canvas.height/20,o}return o=c,(r=[{key:"detectHit",value:function(){this.hit(t.g.player)&&!1===this.used&&(this.used=!0,t.g.player.updateScore(this.value),delete H.rooms[t.g.player.room].treasure[this.id])}}])&&v(o.prototype,r),c}(b);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t,e){return!e||"object"!==j(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(c,e);var o,r,n,i,a=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=M(n);if(i){var o=M(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return P(this,t)});function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=a.call(this)).levels={1:[7,1],2:[10,2],3:[15,3],4:[20,4],5:[25,5]},e.level=null,e.id=t,e.type="Enemy",e.level=Math.floor(5*Math.random())+1,e.radius=e.levels[e.level][0],e.speed=e.levels[e.level][1],e.dx=1,e.dy=1,e.setRandomDirection(),e}return o=c,(r=[{key:"setRandomDirection",value:function(){this.dx*=Math.pow(-1,Math.floor(10*Math.random())),this.dy*=Math.pow(-1,Math.floor(10*Math.random()))}},{key:"update",value:function(){this.detectHit(),this.radius=this.levels[this.level][0],this.speed=this.levels[this.level][1],this.move()}},{key:"detectHit",value:function(){var e=this;Object.keys(t.g.player.projectiles).forEach((function(o){var r=t.g.player.projectiles[o];e.hit(r)&&!1===r.used&&(r.used=!0,console.log("projectile hit enemy!"),e.projectileHit())})),this.hit(t.g.player)?!1===this.overlay&&(this.overlay=!0,t.g.player.updateScore(-200)):this.overlay=!1}},{key:"projectileHit",value:function(){delete t.g.player.projectiles[Projectile.id],this.level>1?this.level-=1:delete H.rooms[t.g.player.room].enemies[this.id]}}])&&R(o.prototype,r),c}(b);function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function W(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var H=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&D(t,e)}(c,e);var o,r,n,i,a=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=C(n);if(i){var o=C(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return W(this,t)});function c(t,e){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(o=a.call(this)).up="",o.right="",o.down="",o.left="",o.endRoom=!1,o.visited=!1,o.availableDirections=4,o.treasure={},o.markers={},o.enemies={},o.id=t,o.up=o.id-e,o.right=o.id+1,o.down=o.id+e,o.left=o.id-1,o.id<e?(o.up=null,o.availableDirections--):o.id>=Math.pow(e,2)-e&&(o.availableDirections--,o.down=null),o.id%e==0?(o.availableDirections--,o.left=null):o.id%e==e-1&&(o.availableDirections--,o.right=null),o.generateTreasure(),o.generateEnemies(),o}return o=c,(r=[{key:"generateTreasure",value:function(){if(Math.random()<=.8){var t=Object.keys(this.treasure).length;this.treasure[t]=new O(t)}}},{key:"generateEnemies",value:function(){if(Math.random()<=1){var t=Object.keys(this.treasure).length;this.enemies[t]=new _(t)}}},{key:"changeRoom",value:function(t){return this[t]}},{key:"addMarker",value:function(){var e=Object.keys(this.markers).length;this.markers[e]=new Marker(e),t.g.background.draw()}}])&&E(o.prototype,r),c}(i);function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function z(t,e){return(z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function N(t,e){return!e||"object"!==I(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function V(t){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}H.rooms=[];var G=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(u,e);var o,r,i,a,c=(i=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=V(i);if(a){var o=V(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return N(this,t)});function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(t=c.call(this)).canvasRect=null,t.canvas=document.getElementById("canvas-background"),t.ctx=t.canvas.getContext("2d"),t.canvas.width=t.dimensions,t.canvas.height=t.dimensions,t.doorMin=t.dimensions*(5/12),t.doorMax=t.dimensions*(7/12),t.canvasRect=t.canvas.getBoundingClientRect(),t}return o=u,(r=[{key:"draw",value:function(){this.clear();var e=t.g.player.room;this.ctx.lineWidth=20,this.drawWalls(),this.drawDoors(e),this.drawMarkers()}},{key:"drawWalls",value:function(){this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.moveTo(0,0),this.ctx.lineTo(this.doorMin,0),this.ctx.moveTo(this.doorMax,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.doorMin),this.ctx.moveTo(this.canvas.width,this.doorMax),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(this.doorMax,this.canvas.height),this.ctx.moveTo(this.doorMin,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,this.doorMax),this.ctx.moveTo(0,this.doorMin),this.ctx.lineTo(0,0),this.ctx.stroke()}},{key:"drawDoors",value:function(t){var e=new n("up"),o=new n("right"),r=new n("down"),i=new n("left");H.rooms[t].up&&(e.status="active"),H.rooms[t].right&&(o.status="active"),H.rooms[t].down&&(r.status="active"),H.rooms[t].left&&(i.status="active"),e.draw(),o.draw(),r.draw(),i.draw()}},{key:"drawMarkers",value:function(){var e=this;Object.keys(H.rooms[t.g.player.room].markers).forEach((function(o){var r=H.rooms[t.g.player.room].markers[o];e.ctx.beginPath(),e.ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),e.ctx.fillStyle="blue",e.ctx.fill()}))}}])&&B(o.prototype,r),u}(o);function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function A(t,e){return!e||"object"!==F(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Y=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(c,e);var o,r,n,i,a=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=J(n);if(i){var o=J(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return A(this,t)});function c(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(t=a.call(this)).canvas=document.getElementById("canvas-foreground"),t.ctx=t.canvas.getContext("2d"),t.canvas.width=t.dimensions,t.canvas.height=t.dimensions,t}return o=c,(r=[{key:"update",value:function(){!0!==t.g.player.finished&&(this.clear(),t.g.player.move(),this.draw(),requestAnimationFrame(this.update.bind(this)))}},{key:"draw",value:function(){this.ctx.beginPath(),this.ctx.arc(t.g.player.x,t.g.player.y,t.g.player.radius,0,2*Math.PI),this.ctx.fillStyle="purple",this.ctx.fill();var e=this;Object.keys(H.rooms[t.g.player.room].treasure).forEach((function(o){var r=H.rooms[t.g.player.room].treasure[o];r.update(),e.ctx.beginPath(),e.ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),e.ctx.fillStyle="gold",e.ctx.fill()})),Object.keys(H.rooms[t.g.player.room].enemies).forEach((function(o){var r=H.rooms[t.g.player.room].enemies[o];r.update(),e.ctx.beginPath(),e.ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),e.ctx.fillStyle="red",e.ctx.fill()})),Object.keys(t.g.player.projectiles).forEach((function(o){var r=t.g.player.projectiles[o];r.move(),e.ctx.beginPath(),e.ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),e.ctx.fillStyle="blue",e.ctx.fill()}))}}])&&U(o.prototype,r),c}(o);function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function X(t,e){return!e||"object"!==K(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Z(t){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var tt=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}(c,e);var o,r,n,i,a=(n=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Z(n);if(i){var o=Z(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return X(this,t)});function c(){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=a.call(this)).room=null,e.score=0,e.time=0,e.won=!1,e.projectileCounter=0,e.projectiles={},e.type="Player",e.x=t.g.background.canvas.width/2,e.y=t.g.background.canvas.height/2,e.radius=t.g.background.canvas.height/40,e.speed=5,e.startTimer(),e}return o=c,(r=[{key:"startTimer",value:function(){var e=Date.now();setInterval((function(){if(!0!==t.g.player.finished){var o=Date.now()-e;t.g.player.time=Math.floor(o/1e3),$("#time").text("Time:  "+t.g.player.time)}}),100)}},{key:"hitDoor",value:function(){var e={};return null!==H.rooms[t.g.player.room].up&&this.y-this.radius+this.dy-t.g.background.ctx.lineWidth<0&&this.variableBetweenValues(this.x,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="up",e.x=this.x,e.y=t.g.background.canvas.height-this.radius-t.g.background.ctx.lineWidth):null!==H.rooms[t.g.player.room].right&&this.x+this.radius+this.dx+t.g.background.ctx.lineWidth>t.g.background.canvas.width&&this.variableBetweenValues(this.y,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="right",e.x=this.radius+t.g.background.ctx.lineWidth,e.y=this.y):null!==H.rooms[t.g.player.room].down&&this.y+this.radius+this.dy+t.g.background.ctx.lineWidth>t.g.background.canvas.height&&this.variableBetweenValues(this.x,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="down",e.x=this.x,e.y=this.radius+t.g.background.ctx.lineWidth):null!==H.rooms[t.g.player.room].left&&this.x-this.radius+this.dx-t.g.background.ctx.lineWidth<0&&this.variableBetweenValues(this.y,t.g.background.doorMin,t.g.background.doorMax)?(e.direction="left",e.x=t.g.background.canvas.width-this.radius-t.g.background.ctx.lineWidth,e.y=this.y):e=!1,!1!==e&&"end"===H.rooms[t.g.player.room][e.direction]&&(this.playerWon(),e=!1),e}},{key:"playerWon",value:function(){this.finished=!0,$("#result").text("You Win!!!")}},{key:"fireProjectile",value:function(t,e){this.projectiles[this.projectileCounter]=new Projectile(this.projectileCounter,t,e),this.projectileCounter++}},{key:"updateScore",value:function(t){this.score+=t,$("#score").text("Score:  "+this.score)}},{key:"resetPosition",value:function(){this.x=t.g.background.canvas.width/2,this.y=t.g.background.canvas.height/2}}])&&L(o.prototype,r),c}(f);function et(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ot=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var o,r;return o=e,(r=[{key:"setupGame",value:function(){H.rooms=[];for(var e=0;e<Math.pow(t.g.settings.gridSize,2);e++)H.rooms.push(new H(e,t.g.settings.gridSize));for(var o=0;o<H.rooms.length;o++)Math.random()<=t.g.settings.removed&&this.deleteRoom(o);t.g.player.room=this.generateRandomRoom(),this.generateRandomEndRoom(),this.mapInvalid()&&(console.log("rebuilding map"),this.setupGame()),H.rooms[t.g.player.room].treasure={},H.rooms[t.g.player.room].markers={},H.rooms[t.g.player.room].enemies={},console.log("startroom",t.g.player.room)}},{key:"deleteRoom",value:function(t){var e=H.rooms[t].up;null!==e&&(H.rooms[e].down=null,H.rooms[e].availableDirections--);var o=H.rooms[t].right;null!==o&&(H.rooms[o].left=null,H.rooms[o].availableDirections--);var r=H.rooms[t].down;null!==r&&(H.rooms[r].up=null,H.rooms[r].availableDirections--);var n=H.rooms[t].left;null!==n&&(H.rooms[n].right=null,H.rooms[n].availableDirections--),H.rooms[t]=null}},{key:"generateRandomRoom",value:function(){var e=Math.floor(Math.random()*Math.pow(t.g.settings.gridSize,2));return null!==H.rooms[e]?e:this.generateRandomRoom()}},{key:"generateRandomEndRoom",value:function(){var e=this.generateRandomRoom();if(4!==H.rooms[e].availableDirections&&e!==t.g.player.room){for(var o=!1,r=["up","right","down","left"],n=null,i=null;!1===o;)n=r[i=Math.floor(Math.random()*r.length)],null===H.rooms[e][n]?(o=!0,H.rooms[e][n]="end"):r.splice(i,1);H.rooms[e].endRoom=!0,console.log("end room:  ",e)}else this.generateRandomEndRoom()}},{key:"getUnvisitedNeighbors",value:function(t){var e=[];return null!==H.rooms[t].up&&"end"!==H.rooms[t].up&&!1===H.rooms[H.rooms[t].up].visited&&e.push(H.rooms[t].up),null!==H.rooms[t].right&&"end"!==H.rooms[t].right&&!1===H.rooms[H.rooms[t].right].visited&&e.push(H.rooms[t].right),null!==H.rooms[t].down&&"end"!==H.rooms[t].down&&!1===H.rooms[H.rooms[t].down].visited&&e.push(H.rooms[t].down),null!==H.rooms[t].left&&"end"!==H.rooms[t].left&&!1===H.rooms[H.rooms[t].left].visited&&e.push(H.rooms[t].left),e}},{key:"mapInvalid",value:function(){for(var e=t.g.player.room,o=null,r=[],n=!0,i=Math.pow(t.g.settings.gridSize,2);;)if(H.rooms[e].visited=!0,!0===H.rooms[e].endRoom&&(n=!1),(o=this.getUnvisitedNeighbors(e)).length>0)r.push(e),e=o[0];else{if(!(r.length>0))break;e=r.pop()}for(var a=0;a<H.rooms.length;a++)null===H.rooms[a]?i--:!1===H.rooms[a].visited&&(i--,H.rooms[a]=null);return i<t.g.settings.minimumNodes&&(n=!0),console.log("available nodes:   ",i),n}}])&&et(o.prototype,r),e}();t.g.settings={},t.g.background=new G,t.g.player=new tt,t.g.foreground=new Y,fetch("./configuration.txt").then((function(t){return t.text()})).then((function(e){(function(e){var o=JSON.parse(e);return o.minimumNodes<Math.pow(o.gridSize,2)*o.removed&&(t.g.settings=o,!0)})(e)?((new ot).setupGame(),console.log("map generated"),t.g.background.draw(),console.log("background drawn"),t.g.foreground.update(),console.log("foreground drawn")):console.log("invalid configuration")}))})();