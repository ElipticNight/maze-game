(()=>{"use strict";class t{constructor(){this.canvas=null,this.ctx=null,this.dimensions=null,this.doorMin=null,this.doorMax=null,this.dimensions=.8*window.innerHeight,$(".background-image").width(this.dimensions/2),$(".background-image").height(this.dimensions/2)}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}class i extends MovableElement{constructor(){super(),this.room=null,this.score=0,this.time=0,this.won=!1,this.projectileCounter=0,this.projectiles={},this.x=background.canvas.width/2,this.y=background.canvas.height/2,this.radius=background.canvas.height/40,this.speed=5,this.startTimer()}startTimer(){let t=Date.now();setInterval((function(){if(!0!==player.finished){let i=Date.now()-t;player.time=Math.floor(i/1e3),$("#time").text("Time:  "+player.time)}}),100)}hitDoor(){let t={};return null!==Room.rooms[player.room].up&&this.y-this.radius+this.dy-background.ctx.lineWidth<0&&this.variableBetweenValues(this.x,background.doorMin,background.doorMax)?(t.direction="up",t.x=this.x,t.y=background.canvas.height-this.radius-background.ctx.lineWidth):null!==Room.rooms[player.room].right&&this.x+this.radius+this.dx+background.ctx.lineWidth>background.canvas.width&&this.variableBetweenValues(this.y,background.doorMin,background.doorMax)?(t.direction="right",t.x=this.radius+background.ctx.lineWidth,t.y=this.y):null!==Room.rooms[player.room].down&&this.y+this.radius+this.dy+background.ctx.lineWidth>background.canvas.height&&this.variableBetweenValues(this.x,background.doorMin,background.doorMax)?(t.direction="down",t.x=this.x,t.y=this.radius+background.ctx.lineWidth):null!==Room.rooms[player.room].left&&this.x-this.radius+this.dx-background.ctx.lineWidth<0&&this.variableBetweenValues(this.y,background.doorMin,background.doorMax)?(t.direction="left",t.x=background.canvas.width-this.radius-background.ctx.lineWidth,t.y=this.y):t=!1,!1!==t&&"end"===Room.rooms[player.room][t.direction]&&(this.playerWon(),t=!1),t}playerWon(){this.finished=!0,$("#result").text("You Win!!!")}fireProjectile(t,i){this.projectiles[this.projectileCounter]=new Projectile(this.projectileCounter,t,i),this.projectileCounter++}updateScore(t){this.score+=t,$("#score").text("Score:  "+this.score)}resetPosition(){this.x=background.canvas.width/2,this.y=background.canvas.height/2}}let e={},s=new class extends t{constructor(){super(),this.canvasRect=null,this.canvas=document.getElementById("canvas-background"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.dimensions,this.canvas.height=this.dimensions,this.doorMin=this.dimensions*(5/12),this.doorMax=this.dimensions*(7/12),this.canvasRect=this.canvas.getBoundingClientRect()}draw(){this.clear();let t=player.room;this.ctx.lineWidth=20,this.drawWalls(),this.drawDoors(t),this.drawMarkers()}drawWalls(){this.ctx.beginPath(),this.ctx.strokeStyle="black",this.ctx.moveTo(0,0),this.ctx.lineTo(this.doorMin,0),this.ctx.moveTo(this.doorMax,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.doorMin),this.ctx.moveTo(this.canvas.width,this.doorMax),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(this.doorMax,this.canvas.height),this.ctx.moveTo(this.doorMin,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,this.doorMax),this.ctx.moveTo(0,this.doorMin),this.ctx.lineTo(0,0),this.ctx.stroke()}drawDoors(t){let i=new Door("up"),e=new Door("right"),s=new Door("down"),o=new Door("left");Room.rooms[t].up&&(i.status="active"),Room.rooms[t].right&&(e.status="active"),Room.rooms[t].down&&(s.status="active"),Room.rooms[t].left&&(o.status="active"),i.draw(),e.draw(),s.draw(),o.draw()}drawMarkers(){let t=this;Object.keys(Room.rooms[player.room].markers).forEach((function(i){let e=Room.rooms[player.room].markers[i];t.ctx.beginPath(),t.ctx.arc(e.x,e.y,e.radius,0,2*Math.PI),t.ctx.fillStyle="blue",t.ctx.fill()}))}},o=(new i,new class extends t{constructor(){super(),this.canvas=document.getElementById("canvas-foreground"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.dimensions,this.canvas.height=this.dimensions}update(){!0!==player.finished&&(this.clear(),player.move(),this.draw(),requestAnimationFrame(this.update.bind(this)))}draw(){this.ctx.beginPath(),this.ctx.arc(player.x,player.y,player.radius,0,2*Math.PI),this.ctx.fillStyle="purple",this.ctx.fill();let t=this;Object.keys(Room.rooms[player.room].treasure).forEach((function(i){let e=Room.rooms[player.room].treasure[i];e.update(),t.ctx.beginPath(),t.ctx.arc(e.x,e.y,e.radius,0,2*Math.PI),t.ctx.fillStyle="gold",t.ctx.fill()})),Object.keys(Room.rooms[player.room].enemies).forEach((function(i){let e=Room.rooms[player.room].enemies[i];e.update(),t.ctx.beginPath(),t.ctx.arc(e.x,e.y,e.radius,0,2*Math.PI),t.ctx.fillStyle="red",t.ctx.fill()})),Object.keys(player.projectiles).forEach((function(i){let e=player.projectiles[i];e.move(),t.ctx.beginPath(),t.ctx.arc(e.x,e.y,e.radius,0,2*Math.PI),t.ctx.fillStyle="blue",t.ctx.fill()}))}});fetch("./configuration.txt").then((t=>t.text())).then((t=>{(function(t){let i=JSON.parse(t);return i.minimumNodes<i.gridSize**2*i.removed&&(e=i,!0)})(t)?(setupGame(),s.draw(),o.update()):console.log("invalid configuration")}))})();